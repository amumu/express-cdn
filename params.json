{"note":"Don't delete this file! It's used internally to help with page regeneration.","name":"Express-cdn","tagline":"Node.js module for delivering optimized, minified, mangled, gzipped, and CDN-hosted assets in Express using S3 and CloudFront.","body":"\r\n# express-cdn <sup>0.0.1</sup>\r\n\r\nNode.js module for delivering optimized, minified, mangled, gzipped, and CDN-hosted assets in Express using S3 and CloudFront.\r\n\r\nFollow <a href=\"http://twitter.com/niftylettuce\" target=\"_blank\">@niftylettuce</a> on Twitter for updates.\r\n\r\nCurrently supports `express` version 2.x (not 3.x compatible yet).\r\n\r\nLike this module?  You should also check out <a href=\"https://github.com/niftylettuce/node-email-templates\" target=\"_blank\">node-email-templates</a>!\r\n\r\n## Features\r\n\r\n* Built-in optimization of images in production mode using [OptiPNG][1] and [JPEGTran][2].\r\n* Supports [Sass][3], [LESS][4], and [Stylus][5] using respective stylesheet compilers.\r\n* JavaScript assets are mangled and minified using [UglifyJS][6].\r\n* Automatic detection of asset changes and will only upload changed assets to S3 in production mode.\r\n* Utilizes cachebusting, which is inspired by [express-cachebuster][7] and [h5bp][8].\r\n* All assets are compressed using [zlib][9] into a gzip buffer for S3 uploading with `Content-Encoding` header set to `gzip`.\r\n* Embed multiple assets as a single `<script>` or `<link>` tag using the built-in dynamic view helper.\r\n* Loads and processes assets per view (allowing you to minimize client HTTP requests).\r\n* Combine commonly used assets together using a simple array argument.\r\n* Uploads changed assets automatically and asynchronously to Amazon S3 (only in production mode) using [knox][10].\r\n\r\n\r\n\r\n## Lazy Web Requests\r\n\r\n* Automatic parsing of `CDN(...)` in stylesheets and scripts.\r\n* Modularization of `/lib/main.js` please!\r\n* Support Express 3.x.x+ and utilize async with view helper.\r\n* Convert from `fs.statSync` to `fs.stat` with callback for image assets modified timestamp hack.\r\n* Investigate why Chrome Tools Audit returns leverage proxy cookieless jargon.\r\n\r\n\r\n\r\n## How does it work?\r\n\r\nWhen the server is first started, the module returns a view helper depending on\r\nthe server environment (production or development).  It also recursively\r\nsearches through your `viewsDir` for any views containing instances of the\r\n`CDN(...)` view helper.  After parsing each instance and removing duplicates,\r\nit will use your S3 credentials to upload a new copy of the production-quality\r\nassets.  Enjoy **:)**.\r\n\r\n\r\n\r\n## Environment Differences\r\n\r\n**Development Mode:**\r\n\r\nAssets are untouched, cachebusted, and delivered as typical local files for rapid development.\r\n\r\n**Production Mode:**\r\n\r\nAssets are optimized, minified, mangled, gzipped, delivered by Amazon CloudFront CDN, and hosted from Amazon S3.\r\n\r\n\r\n\r\n## CDN Setup Instructions\r\n\r\n1. Visit <https://console.aws.amazon.com/s3/home> and click **Create Bucket**.\r\n  * Bucket Name: `bucket-name`\r\n  * Region: `US Standard`\r\n2. Upload <a href=\"https://raw.github.com/niftylettuce/express-cdn/master/index.html\">index.html</a> to your new bucket (this will serve as a placeholder in case someone accesses <http://cdn.your-site.com/>).\r\n3. Select `index.html` in the Objects and Folders view from your S3 console and click **Actions &rarr; Make Public**.\r\n4. Visit <https://console.aws.amazon.com/cloudfront/home> and click **Create Distribution**.\r\n  * Choose an origin:\r\n      - Origin Domain Name: `bucket-name.s3.amazonaws.com`\r\n      - Origin ID: `S3-bucket-name`\r\n  * Create default behavior:\r\n      - Path Pattern: `Default (*)`\r\n      - Origin: `S3-bucket-name`\r\n      - Viewer Protocol Policy: `HTTP and HTTPS`\r\n      - Object Caching: `Use Origin Cache Headers`\r\n      - Forward Query String: `No (Improves Caching)`\r\n  * Distribution details:\r\n      - Alternate Domain Names (CNAMEs): `cdn.your-domain.com`\r\n      - Default Root Object: `index.html`\r\n      - Logging: `Off`\r\n      - Comments: `Created with express-cdn by @niftylettuce.`\r\n      - Distribution State: `Enabled`\r\n5. Copy the generated Domain Name (e.g. `xyz.cloudfront.net`) to your clipboard.\r\n6. Log in to your-domain.com's DNS manager, add a new CNAME \"hostname\" of `cdn`, and paste the contents of your clipboard as the the \"alias\" or \"points to\" value.\r\n7. After the DNS change propagates, you can test your new CDN by visiting <http://cdn.your-domain.com> (the `index.html` file should get displayed).\r\n\r\n\r\n\r\n## Installation\r\n\r\n```bash\r\n# install optipng and jpegtran packages\r\nsudo apt-get install optipng libjpeg-progs\r\n\r\n# install express-cdn module\r\nnpm install express-cdn\r\n```\r\n\r\n\r\n\r\n## Usage\r\n\r\n### Server\r\n\r\n```js\r\n// # express-cdn\r\n\r\nvar express = require('express')\r\n  , path    = require('path')\r\n  , app     = express.createServer();\r\n\r\n// Set the CDN options\r\nvar options = {\r\n    publicDir  : path.join(__dirname, 'public')\r\n  , viewsDir   : path.join(__dirname, 'views')\r\n  , domain     : 'cdn.your-domain.com'\r\n  , bucket     : 'bucket-name'\r\n  , key        : 'amazon-s3-key'\r\n  , secret     : 'amazon-s3-secret'\r\n  , hostname   : 'localhost'\r\n  , port       : 1337\r\n  , ssl        : false\r\n  , production : true\r\n};\r\n\r\n// Initialize the CDN magic\r\nvar CDN = require('express-cdn')(app, options);\r\n\r\napp.configure(function() {\r\n  app.set('view engine', 'jade');\r\n  app.set('view options', { layout: false, pretty: true });\r\n  app.enable('view cache');\r\n  app.use(express.bodyParser());\r\n  app.use(express.static(path.join(__dirname, 'public')));\r\n});\r\n\r\n// Add the dynamic view helper\r\napp.dynamicHelpers({ CDN: CDN });\r\n\r\napp.get('/', function(req, res, next) {\r\n  res.render('basic');\r\n  return;\r\n});\r\n\r\nconsole.log(\"Server started: http://localhost:1337\");\r\napp.listen(1337);\r\n```\r\n\r\n### View Engine\r\n\r\n#### Jade\r\n\r\n```jade\r\n// #1 - Load an image\r\n!= CDN('/img/sprite.png')\r\n\r\n// #2 - Load an image with a custom tag attribute\r\n!= CDN('/img/sprite.png', { alt: 'Sprite' })\r\n\r\n// #3 - Load a script\r\n!= CDN('/js/script.js')\r\n\r\n// #4 - Load a script with a custom tag attribute\r\n!= CDN('/js/script.js', { 'data-message': 'Hello' })\r\n\r\n// #5 - Load and concat two scripts\r\n!= CDN([ '/js/plugins.js', '/js/script.js' ])\r\n\r\n// #6 - Load and concat two scripts with custom tag attributes\r\n!= CDN([ '/js/plugins.js', '/js/script.js' ], { 'data-message': 'Hello' })\r\n\r\n// #7 - Load a stylesheet\r\n!= CDN('/css/style.css')\r\n\r\n// #8 - Load and concat two stylesheets\r\n!= CDN([ '/css/style.css', '/css/extra.css' ])\r\n```\r\n\r\n#### EJS\r\n\r\n```ejs\r\n<!-- #1 - Load an image -->\r\n<%- CDN('/img/sprite.png') %>\r\n\r\n<!-- #2 - Load an image with a custom tag attribute -->\r\n<%- CDN('/img/sprite.png', { alt: 'Sprite' }) %>\r\n\r\n<!-- #3 - Load a script -->\r\n<%- CDN('/js/script.js') %>\r\n\r\n<!-- #4 - Load a script with a custom tag attribute -->\r\n<%- CDN('/js/script.js', { 'data-message': 'Hello' }) %>\r\n\r\n<!-- #5 - Load and concat two scripts -->\r\n<%- CDN([ '/js/plugins.js', '/js/script.js' ]) %>\r\n\r\n<!-- #6 - Load and concat two scripts with custom tag attributes -->\r\n<%- CDN([ '/js/plugins.js', '/js/script.js' ], { 'data-message': 'Hello' }) %>\r\n\r\n<!-- #7 - Load a stylesheet -->\r\n<%- CDN('/css/style.css') %>\r\n\r\n<!-- #8 - Load and concat two stylesheets -->\r\n<%- CDN([ '/css/style.css', '/css/extra.css' ]) %>\r\n```\r\n\r\n### Automatically Rendered HTML\r\n\r\n#### Development Mode\r\n\r\n```html\r\n<!-- #1 - Load an image -->\r\n<img src=\"/img/sprite.png?v=1341214029\" />\r\n\r\n<!-- #2 - Load an image with a custom tag attribute -->\r\n<img src=\"/img/sprite.png?v=1341214029\" alt=\"Sprite\" />\r\n\r\n<!-- #3 - Load a script -->\r\n<script src=\"/js/script.js?v=1341214029\" type=\"text/javascript\"></script>\r\n\r\n<!-- #4 - Load a script with a custom tag attribute -->\r\n<script src=\"/js/script.js?v=1341214029\" type=\"text/javascript\" data-message=\"Hello\"></script>\r\n\r\n<!-- #5 - Load and concat two scripts -->\r\n<script src=\"/js/plugins.js?v=1341214029\" type=\"text/javascript\"></script>\r\n<script src=\"/js/script.js?v=1341214029\" type=\"text/javascript\"></script>\r\n\r\n<!-- #6 - Load and concat two scripts with custom tag attributes -->\r\n<script src=\"/js/plugins.js?v=1341214029\" type=\"text/javascript\" data-message=\"Hello\"></script>\r\n<script src=\"/js/script.js?v=1341214029\" type=\"text/javascript\" data-message=\"Hello\"></script>\r\n\r\n<!-- #7 - Load a stylesheet -->\r\n<link href=\"/css/style.css?v=1341214029\" rel=\"stylesheet\" type=\"text/css\" />\r\n\r\n<!-- #8 - Load and concat two stylesheets -->\r\n<link href=\"/css/style.css?v=1341214029\" rel=\"stylesheet\" type=\"text/css\" />\r\n<link href=\"/css/extra.css?v=1341214029\" rel=\"stylesheet\" type=\"text/css\" />\r\n```\r\n\r\n#### Production Mode\r\n\r\nThe protocol will automatically change to \"https\" or \"http\" depending on the SSL option.\r\n\r\nThe module will automatically upload and detect new/modified assets based off timestamp,\r\nas it utilizes the timestamp for version control!  There is built-in magic to detect if\r\nindividual assets were changed when concatenating multiple assets together (it adds the\r\ntimestamps together and checks if the combined asset timestamp on S3 exists!).\r\n\r\n```html\r\n<!-- #1 - Load an image -->\r\n<img src=\"https://cdn.your-site.com/img/sprite.1341382571.png\" />\r\n\r\n<!-- #2 - Load an image with a custom tag attribute -->\r\n<img src=\"https://cdn.your-site.com/img/sprite.1341382571.png\" alt=\"Sprite\" />\r\n\r\n<!-- #3 - Load a script -->\r\n<script src=\"https://cdn.your-site.com/js/script.1341382571.js\" type=\"text/javascript\"></script>\r\n\r\n<!-- #4 - Load a script with a custom tag attribute -->\r\n<script src=\"https://cdn.your-site.com/js/script.1341382571.js\" type=\"text/javascript\" data-message=\"Hello\"></script>\r\n\r\n<!-- #5 - Load and concat two scripts -->\r\n<script src=\"https://cdn.your-site.com/plugins%2Bscript.1341382571.js\" type=\"text/javascript\"></script>\r\n\r\n<!-- #6 - Load and concat two scripts with custom tag attributes -->\r\n<script src=\"https://cdn.your-site.com/plugins%2Bscript.1341382571.js\" type=\"text/javascript\" data-message=\"Hello\"></script>\r\n\r\n<!-- #7 - Load a stylesheet -->\r\n<link href=\"https://cdn.your-site.com/css/style.1341382571.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n\r\n<!-- #8 - Load and concat two stylesheets -->\r\n<link href=\"https://cdn.your-site.com/style%2Bextra.1341382571.css\" rel=\"stylesheet\" type=\"text/css\" />\r\n```\r\n\r\n\r\n\r\n## Contributors\r\n\r\n* Nick Baugh <niftylettuce@gmail.com>\r\n\r\n\r\n\r\n## License\r\n\r\nMIT Licensed\r\n\r\n\r\n\r\n[1]: http://optipng.sourceforge.net/\r\n[2]: http://jpegclub.org/jpegtran/\r\n[3]: http://sass-lang.com/\r\n[4]: http://lesscss.org/\r\n[5]: http://learnboost.github.com/stylus/\r\n[6]: https://github.com/mishoo/UglifyJS/\r\n[7]: https://github.com/niftylettuce/express-cachebuster/\r\n[8]: http://h5bp.com/\r\n[9]: http://nodejs.org/api/zlib.html\r\n[10]: https://github.com/LearnBoost/knox/\r\n","google":"UA-33131011-1"}